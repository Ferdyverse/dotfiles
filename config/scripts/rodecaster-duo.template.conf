context.modules = [
    # +++++++++++++++++++++++++++++++++++++++++++++++++++++
    # Audio Sources / Input Devices
    # +++++++++++++++++++++++++++++++++++++++++++++++++++++

    # Main Mix (aka. Main)
    {   name = libpipewire-module-loopback
        args = {
            node.name = "virtual_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.main"
            node.description = "RODECaster Duo Main Mix"
            audio.position = [ FL FR ]

            capture.props = {
                target.object = "alsa_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-input-1"
                audio.position = [ AUX0 AUX1 ]
                stream.dont-remix = true
                node.passive = true
            }

            playback.props = { media.class = "Audio/Source" }
        }
    },

    # Combo 1, Combo 2
    {
        name = libpipewire-module-loopback
        args = {
            node.name = "virtual_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.combo1"
            node.description = "RODECaster Duo Combo 1"
            audio.position = [ MONO ]

            capture.props = {
                target.object = "alsa_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-input-1"
                audio.position = [ AUX2 ]
                stream.dont-remix = true
                node.passive = true
            }

            playback.props = { media.class = "Audio/Source" }
        }
    },
    {
        name = libpipewire-module-loopback
        args = {
            node.name = "virtual_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.combo2"
            node.description = "RODECaster Duo Combo 2"
            audio.position = [ MONO ]

            capture.props = {
                target.object = "alsa_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-input-1"
                audio.position = [ AUX3 ]
                stream.dont-remix = true
                node.passive = true
            }

            playback.props = { media.class = "Audio/Source" }
        }
    },

    # Bluetooth
    {   name = libpipewire-module-loopback
        args = {
            node.name = "virtual_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.bluetooth"
            node.description = "RODECaster Duo Bluetooth"
            audio.position = [ FL FR ]

            capture.props = {
                target.object = "alsa_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-input-1"
                audio.position = [ AUX4 AUX5 ]
                stream.dont-remix = true
                node.passive = true
            }

            playback.props = { media.class = "Audio/Source" }
        }
    },

    # SMART Pads
    {   name = libpipewire-module-loopback
        args = {
            node.name = "virtual_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.smartpads"
            node.description = "RODECaster Duo SMART Pads"
            audio.position = [ FL FR ]

            capture.props = {
                target.object = "alsa_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-input-1"
                audio.position = [ AUX6 AUX7 ]
                stream.dont-remix = true
                node.passive = true
            }

            playback.props = { media.class = "Audio/Source" }
        }
    },

    # System
    {   name = libpipewire-module-loopback
        args = {
            node.name = "virtual_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.system"
            node.description = "RODECaster Duo System"
            audio.position = [ FL FR ]

            capture.props = {
                target.object = "alsa_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-input-1"
                audio.position = [ AUX8 AUX9 ]
                stream.dont-remix = true
                node.passive = true
            }

            playback.props = { media.class = "Audio/Source" }
        }
    },

    # Chat
    {   name = libpipewire-module-loopback
        args = {
            node.name = "virtual_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.chat"
            node.description = "RODECaster Duo Chat"
            audio.position = [ FL FR ]

            capture.props = {
                target.object = "alsa_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-input-1"
                audio.position = [ AUX10 AUX11 ]
                stream.dont-remix = true
                node.passive = true
            }

            playback.props = { media.class = "Audio/Source" }
        }
    },

    # USB 2
    {   name = libpipewire-module-loopback
        args = {
            node.name = "virtual_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.usb2"
            node.description = "RODECaster Duo USB 2"
            audio.position = [ FL FR ]

            capture.props = {
                target.object = "alsa_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-input-1"
                audio.position = [ AUX12 AUX13 ]
                stream.dont-remix = true
                node.passive = true
            }

            playback.props = { media.class = "Audio/Source" }
        }
    },


    # +++++++++++++++++++++++++++++++++++++++++++++++++++++
    # Audio Sinks / Output Devices
    # +++++++++++++++++++++++++++++++++++++++++++++++++++++


    # System (aka. Main)
    {   name = libpipewire-module-loopback
        args = {
            node.name = "virtual_output.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.main"
            node.description = "RODECaster Duo System"
            audio.position = [ FL FR ]
            
            capture.props = { media.class = "Audio/Sink" }
                
            playback.props = {
                target.object = "alsa_output.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-output-1"
                stream.dont-remix = true
                audio.position = [ AUX0 AUX1 ]
            }
        }
    },
    
    # Game
    {
        name = libpipewire-module-loopback
        args = {
            node.name = "virtual_output.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.game"
            node.description = "RODECaster Duo Game"
            audio.position = [ FL FR ]
            
            capture.props = { media.class = "Audio/Sink" }
            
            playback.props = {
                target.object = "alsa_output.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-output-1"
                stream.dont-remix = true
                audio.position = [ AUX2 AUX3 ]
            }
        }
    },

    # Music
    {
        name = libpipewire-module-loopback
        args = {
            node.name = "virtual_output.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.music"
            node.description = "RODECaster Duo Music"
            audio.position = [ FL FR ]
            
            capture.props = { media.class = "Audio/Sink" }
            
            playback.props = {
                target.object = "alsa_output.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-output-1"
                stream.dont-remix = true
                audio.position = [ AUX4 AUX5 ]
            }
        }
    },

    # Virtual A
    {
        name = libpipewire-module-loopback
        args = {
            node.name = "virtual_output.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.a"
            node.description = "RODECaster Duo Virtual A"
            audio.position = [ FL FR ]

            capture.props = { media.class = "Audio/Sink" }

            playback.props = {
                target.object = "alsa_output.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-output-1"
                stream.dont-remix = true
                audio.position = [ AUX6 AUX7 ]
            }
        }
    },

    # Virtual B
    {
        name = libpipewire-module-loopback
        args = {
            node.name = "virtual_output.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.b"
            node.description = "RODECaster Duo Virtual B"
            audio.position = [ FL FR ]

            capture.props = { media.class = "Audio/Sink" }

            playback.props = {
                target.object = "alsa_output.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-output-1"
                stream.dont-remix = true
                audio.position = [ AUX8 AUX9 ]
            }
        }
    }
]

# assign correct names to physical devices
node.rules = [
    # output
    {
        matches = [
            {
                node.name = "alsa_output.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-output-1"
            }
        ]
        actions = {
            update-props = {
                node.description = "RODECaster Duo Multi-Channel"
                node.nick = "RODECaster Duo Multi-Channel"
            }
        }
    },
    {
        matches = [
            {
                node.name = "alsa_output.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-output-0"
            }
        ]
        actions = {
            update-props = {
                node.description = "RODECaster Duo Chat"
                node.nick = "RODECaster Duo Chat"
            }
        }
    },
    # input
    {
        matches = [
            {
                node.name = "alsa_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-input-1"
            }
        ]
        actions = {
            update-props = {
                node.description = "RODECaster Duo Multi-Channel"
                node.nick = "RODECaster Duo Multi-Channel"
            }
        }
    },
    {
        matches = [
            {
                node.name = "alsa_input.usb-R__DE_RODECaster_Duo_{{DEVICE_SERIAL}}.pro-input-0"
            }
        ]
        actions = {
            update-props = {
                node.description = "RODECaster Duo Microphone"
                node.nick = "RODECaster Duo Microphone"
            }
        }
    },
]